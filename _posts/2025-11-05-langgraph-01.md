---
layout: single
title: "[LangGraph] 완전 기초 구현"
categories: LangGraph
tags: [LangGraph]
toc: true
---

```python
from dotenv import load_dotenv
load_dotenv()
```



​    True




```python
from langchain_openai import ChatOpenAI
query = '서경대 역사를 짧게 알려줘'

llm = ChatOpenAI(model='gpt-5-mini')
llm.invoke(query)
```




​    AIMessage(content='서경대라고 하신 건 서경대학교(서울 종암동)에 있는 서경대 맞나요? 맞으면 짧게 역사 요약해 드릴게요.', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 686, 'prompt_tokens': 16, 'total_tokens': 702, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 640, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_provider': 'openai', 'model_name': 'gpt-5-mini-2025-08-07', 'system_fingerprint': None, 'id': 'chatcmpl-CYqCoIhqUuMQn2W7NyOlYoLKPM6vq', 'service_tier': 'default', 'finish_reason': 'stop', 'logprobs': None}, id='lc_run--a94aaa52-d72f-43dc-a6e9-e557937c9904-0', usage_metadata={'input_tokens': 16, 'output_tokens': 686, 'total_tokens': 702, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 640}})



- query선언과 모델 정의 및 invoke를 통한 쿼리 전달과 출력 반환


```python
from typing import Annotated
from typing_extensions import TypedDict

from langgraph.graph.message import add_messages
from langchain_core.messages import AnyMessage

class AgentState(TypedDict):
    messages: list[Annotated[AnyMessage, add_messages]]
```

- 에이전트 상태 클래스 생성 후 메시지를 누적


```python
from langgraph.graph import StateGraph

graph_builder = StateGraph(AgentState)
```

- 그래프 생성


```python
def generate(state: AgentState) -> AgentState:
    message = state['messages']
    ai_message = llm.invoke(message)
    return {'messages': [ai_message]}
```

- 그래프에 추가할 노드를 만듬
- generate노드 정의 후 query메세지와 그 답변인 ai_message를 담음


```python
graph_builder.add_node('generate', generate)
```




​    <langgraph.graph.state.StateGraph at 0x21bd6192f10>



- 노드를 생성한 후에 엣지로 연결


```python
from langgraph.graph import START, END

graph_builder.add_edge(START, 'generate')
graph_builder.add_edge('generate', END)
```




​    <langgraph.graph.state.StateGraph at 0x21bd6192f10>



- 모든 그래프는 시작과 종료가 있음


```python
graph = graph_builder.compile()
```

- 그래프 컴파일


```python
from IPython.display import display, Image

display(Image(graph.get_graph().draw_mermaid_png()))
```


​    
![2025-11-05-langgraph-01](/images/2025-11-05-langgraph-01/graph.jpg)
​    


- 그래프 시각화


```python
from langchain_core.messages import HumanMessage

initial_state = {'messages': [HumanMessage(query)]}
graph.invoke(initial_state)
```




​    {'messages': [AIMessage(content='짧게 알려드릴게요 — 연도(설립연도 등)를 포함한 간단한 연혁을 원하세요, 아니면 한두 문장 정도의 개요만 원하세요? 어떤 형태로 드릴지 알려주세요.', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 829, 'prompt_tokens': 16, 'total_tokens': 845, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 768, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_provider': 'openai', 'model_name': 'gpt-5-mini-2025-08-07', 'system_fingerprint': None, 'id': 'chatcmpl-CYqCzDdZteWZDQVFRYxrxlCAdK26D', 'service_tier': 'default', 'finish_reason': 'stop', 'logprobs': None}, id='lc_run--48505881-67b7-41b2-8d1a-90b9be73f1f5-0', usage_metadata={'input_tokens': 16, 'output_tokens': 829, 'total_tokens': 845, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 768}})]}
