---
layout: single
title: "[LangGraph] 데이터 전처리 고민"
categories: LangGraph
tags: [LangGraph]
toc: true
---

## 임베딩 서치의 정확도의 문제

```python
retriever = vector_store.as_retriever(search_kwargs={'k': 3})
query = '21학번 컴퓨터공학과 졸업요건은 어때'
retriever.invoke(query)
```

```markdown
[Document(id='caf07879-b0bf-4630-9f92-3854d29cbbc0', metadata={'source': './documents/catalog_2024.txt'}, page_content="TOEIC 및 TOEIC Speaking 점수는 졸업일 기준으로 2년 이내의 것을 인정함.\n\n\n326 -\n\n\n□ 학과 졸업 요건 : 학과 내규\n< 전자컴퓨터공학과 졸업요건 >\n\n학교 규정에 따른 졸업요건 충족.  \n'졸업인증제'에 따라 CREOS 인증을 획득하여야 함.  \n졸업하기 위하여 마지막 학기에 수강해야 하는 '졸업논문및시험(EN1066)' 교과목의 학점 취득을 위해서 다음의 요건을 충족해야 함. 미 충족 시 NP로 처리되어 졸업이 불가함.\n\n| 구분 | 적용학번 | 졸업요건 | 비고 |\n|---|---|---|---|\n| 이수필수 | 2022학번까지 | 통합 이전 학과의 졸업요건에 따름 | 전체필수 |\n|  | 2023학번부터 | 1) 전공핵심교과목(전자컴퓨터공학개론, C프로그래밍, 논리회로, 컴퓨터구조) 전과목 학점 취득2) 1학년 1,2학기, 2학년 1학기 개설 전체 전공 교과목 수강3) 공학종합설계1, 공학종합설계2 학점 취득 | 전체필수 |\n| 영어 | 2023학번부터 | 1) TOEIC 700점 이상2) TOEIC Speaking Lv.5 이상3) OPIC IL 이상 | 택1 |\n| 졸업작품 / 졸업논문 | 전체 | 1) 졸업작품 제출 및 심사통과 (모든 졸업자는 예외 없이 졸업작품전 참가 필수)2) 졸업논문 제출 (파일 별도 제출) | 전체필수 |\n※ 졸업작품 및 졸업논문 제출은 취업 여부와 상관없이 모든 졸업예정자에 해당함.\n\n327 -\n\n나노화학생명공학과\n(Department of Nano–Chemical, Biological & Environmental Engineering)\n\n교육목표"),
 Document(id='c79b0357-349c-449a-9869-4f4ac94b6c78', metadata={'source': './documents/catalog_2024.txt'}, page_content='311 -\n\n6. 졸업 요건\n□ 학교 졸업 요건\n\n외국어 졸업 요건\n\n1) 영역별 요건\n| 구분 | 내 용 | 비 고 |\n|---|---|---|\n| 외국어졸업요건(택1) | · 영어, 일본어 또는 중국어 공인어학성적 취득(택1)·대체인정과목 4학점 이수 | ※ 아래 표 참조※ 인정기준·동일 언어, 동일 교과목명 2과목 이수·각 과목 평점 3.0(B0) 이상(2023입학자부터) |\n2) 공인어학성적별 졸업요건 (이공대학 기준)\n졸업요건(택1)\n| 영어 | 일본어 | 중국어 |\n|---|---|---|\n| TOEIC | JPT | TSC |\n| 600점 이상 | 650점 이상 | 3급(180점) 이상 |\n| TOEIC Speaking | JLPT | HSK |\n| Intermediate Low 이상 | N2 이상 | 5급(180점) 이상 |\n| TOEFL | Opic | IELTS |\n| 60점 이상 | Intermediate Low 이상 | 6 이상 |\n\n\nTOEIC 및 TOEIC Speaking 점수는 졸업일 기준으로 2년 이내의 것을 인정함.\n\n\n졸업인증제\n\n\n1) 적용 대상\n| 적용대상 | 비고 |\n|---|---|\n| 2017학년도 입학자부터 적용 | 편입생 제외 |\n2) 내용\n| 영역 | 인 증 요 건 | 비고 |\n|---|---|---|\n| 비교과 | 1. 1학년 CREOS 캠프,2. 2학년 SKON 캠프3. 3학년 DREAM 캠프※ 1 ~ 3 미이수 시 별도 요건을 충족하여야 함 | ※ 캠프별 이수기준에 따름 |\n\n312 -\n\n□ 금융정보공학과 졸업 요건 : 학과 내규\n\n상기 학교 규정에 따른 졸업요건 충족  \n졸업하기 위하여 마지막 학기에 수강해야 하는 "졸업논문및시험(FI1999)" 교과목의 학점 취득을 위해서 다음의 3가지 요건을 충족해야 한다.'),
 Document(id='071ca2b4-5d75-4ff1-b418-f9fcf249a1b5', metadata={'source': './documents/catalog_2024.txt'}, page_content='311 -\n\n6. 졸업 요건\n□ 학교 졸업 요건\n\n외국어 졸업 요건\n\n1) 영역별 요건\n| 구분 | 내 용 | 비 고 |\n|---|---|---|\n| 외국어졸업요건(택1) | · 영어, 일본어 또는 중국어 공인어학성적 취득(택1)·대체인정과목 4학점 이수 | ※ 아래 표 참조※ 인정기준·동일 언어, 동일 교과목명 2과목 이수·각 과목 평점 3.0(B0) 이상(2023입학자부터) |\n2) 공인어학성적별 졸업요건 (이공대학 기준)\n졸업요건(택1)\n| 영어 | 일본어 | 중국어 |\n|---|---|---|\n| TOEIC | JPT | TSC |\n| 600점 이상 | 650점 이상 | 3급(180점) 이상 |\n| TOEIC Speaking | JLPT | HSK |\n| Intermediate Low 이상 | N2 이상 | 5급(180점) 이상 |\n| TOEFL | Opic | IELTS |\n| 60점 이상 | Intermediate Low 이상 | 6 이상 |\n\n\nTOEIC 및 TOEIC Speaking 점수는 졸업일 기준으로 2년 이내의 것을 인정함.\n\n\n졸업인증제\n\n\n1) 적용 대상\n| 적용대상 | 비고 |\n|---|---|\n| 2017학년도 입학자부터 적용 | 편입생 제외 |\n2) 내용\n| 영역 | 인 증 요 건 | 비고 |\n|---|---|---|\n| 비교과 | 1. 1학년 CREOS 캠프,2. 2학년 SKON 캠프3. 3학년 DREAM 캠프※ 1 ~ 3 미이수 시 별도 요건을 충족하여야 함 | ※ 캠프별 이수기준에 따름 |\n\n312 -\n\n□ 금융정보공학과 졸업 요건 : 학과 내규\n\n상기 학교 규정에 따른 졸업요건 충족  \n졸업하기 위하여 마지막 학기에 수강해야 하는 "졸업논문및시험(FI1999)" 교과목의 학점 취득을 위해서 다음의 3가지 요건을 충족해야 한다.')]
```

- 많은 정보를 전달해주려고 k 값을 3개로 했는데 오히려 그 이후에는 다른 학과 졸업요건이 나오는 걸 확인 가능함
- 대처 방안 : k값을 1로 수정 해보자

```markdown
[Document(id='caf07879-b0bf-4630-9f92-3854d29cbbc0', metadata={'source': './documents/catalog_2024.txt'}, page_content="TOEIC 및 TOEIC Speaking 점수는 졸업일 기준으로 2년 이내의 것을 인정함.\n\n\n326 -\n\n\n□ 학과 졸업 요건 : 학과 내규\n< 전자컴퓨터공학과 졸업요건 >\n\n학교 규정에 따른 졸업요건 충족.  \n'졸업인증제'에 따라 CREOS 인증을 획득하여야 함.  \n졸업하기 위하여 마지막 학기에 수강해야 하는 '졸업논문및시험(EN1066)' 교과목의 학점 취득을 위해서 다음의 요건을 충족해야 함. 미 충족 시 NP로 처리되어 졸업이 불가함.\n\n| 구분 | 적용학번 | 졸업요건 | 비고 |\n|---|---|---|---|\n| 이수필수 | 2022학번까지 | 통합 이전 학과의 졸업요건에 따름 | 전체필수 |\n|  | 2023학번부터 | 1) 전공핵심교과목(전자컴퓨터공학개론, C프로그래밍, 논리회로, 컴퓨터구조) 전과목 학점 취득2) 1학년 1,2학기, 2학년 1학기 개설 전체 전공 교과목 수강3) 공학종합설계1, 공학종합설계2 학점 취득 | 전체필수 |\n| 영어 | 2023학번부터 | 1) TOEIC 700점 이상2) TOEIC Speaking Lv.5 이상3) OPIC IL 이상 | 택1 |\n| 졸업작품 / 졸업논문 | 전체 | 1) 졸업작품 제출 및 심사통과 (모든 졸업자는 예외 없이 졸업작품전 참가 필수)2) 졸업논문 제출 (파일 별도 제출) | 전체필수 |\n※ 졸업작품 및 졸업논문 제출은 취업 여부와 상관없이 모든 졸업예정자에 해당함.\n\n327 -\n\n나노화학생명공학과\n(Department of Nano–Chemical, Biological & Environmental Engineering)\n\n교육목표")]
```

- 정확히 해당학과에 대한 기준이 잘 나옴. 하지만 공통 졸업 요건을 포함시키지 못함
- 대처 방안 :
  - 공통 졸업 요건 서치 노드와 개별 학과 졸업 요건 서치 노드를 태워서 generate노드에 전달
  - 메타데이터 정보를 추가해줌

| 테스트하고 다음 글에서 평가 해보겠습니다!