---
layout: single
title: "[LangGraph] bm25사용하여 키워드로 추출"
categories: LangGraph
tags: [LangGraph]
toc: true
---

## 이전 여러번의 방법을 시도했음에도 query에 해당하는 k값이 잘 나오지 않았음을 확인함
- 기존: 그냥 큰 문서 하나를 일정 범위 오버랩 청크 후, 메타데이터로 필터링 하고 정보를 가져옴
- - 정확한 k값을 가져오는데 큰 도움을 받지 못하였음
- 대안: bm25로 키워드에 대한 정확한 값을 추출

```python
query_1 = "컴퓨터공학과 2021학번 졸업요건 알려줘"
query_2 = "컴공 21학번 졸업"

print("---------------------------------------")
print(vector_retriever.invoke(query_1))
print(bm25_retriever.invoke(query_1))
print("---------------------------------------")
print(vector_retriever.invoke(query_2))
print(bm25_retriever.invoke(query_2))
print("---------------------------------------")
```
```markdown
---------------------------------------
[Document(id='944a467a-7a26-4283-b58b-c9cdcffe5456', metadata={'h1': '전자컴퓨터공학과/2023학번/졸업요건'}, page_content='# 전자컴퓨터공학과/2023학번/졸업요건  \n1. 전공핵심 및 필수 교과목 (필수 이수)\n2023학번 이후 입학생은 아래 과목과 학년별 개설 과목을 필수로 이수해야 합니다.\n* 전공핵심 4과목 전체:\n1. 전자컴퓨터공학개론(EN1001) 또는 인공지능기초(EN1065) 중 택 1\n2. C프로그래밍 (EN1002)\n3. 컴퓨터구조 (EN1011)\n4. 논리회로 (EN1006)\n* 저학년 필수 과목: 1학년 1·2학기, 2학년 1학기에 개설되는 전체 전공교과목 이수\n* 설계 과목: 공학종합설계1, 공학종합설계2 학점 취득\n* 졸업논문및시험 (EN1066): 졸업 직전 학기 필수 수강 (미이수 시 졸업 불가)  \n2. 영어 요건 (택 1)\n아래 어학 성적 중 하나 이상을 충족해야 합니다.\n* TOEIC: 700점 이상\n* TOEIC Speaking: Lv.5 이상\n* OPIC: IL 이상  \n3. 졸업작품 및 논문 (전체 공통)\n취업 여부와 무관하게 모든 졸업예정자는 아래 사항을 이행해야 합니다.\n* 졸업작품: 제출 및 심사 통과 (작품전 참가 필수)\n* 졸업논문: 파일 제출  \n4. 기타 요건\n* 학교 공통 졸업요건 및 졸업인증제(CREOS) 인증 필수')]
[Document(metadata={'h1': '컴퓨터공학과/2021학번/졸업요건'}, page_content='# 컴퓨터공학과/2021학번/졸업요건\n2021학번 컴퓨터공학과 졸업요건입니다.\n1. 전공핵심 교과목 (필수 이수)\n2021학번 이후 입학생은 아래 전공핵심 과목을 모두 이수해야 하며, 미이수 시 졸업이 불가합니다. (취업, 현장학습 등 예외 없음)\n* C프로그래밍 (CE1001)\n* 컴퓨터구조 (CE1063)\n* 자료구조 (CE1008)\n* 운영체제 (CE1069)\n* 졸업논문및시험 (CE1999): 졸업 직전 학기에 반드시 수강 신청해야 함.  \n2. 졸업요건 통과 기준 (4개 요소)\n졸업요건 4개 요소(졸업작품, 기사자격증, 영어성적, 전공이수) 중 ‘상 2개 + 중 2개’ 이상 또는 그에 상응하는 등급을 충족해야 합니다.\n* 졸업논문및시험(CE1999) P(Pass) 필수  \n(1) 졸업작품\n* 상: 90점 이상 (또는 1급 기사자격증 취득 시 인정)\n* 중: 70 ~ 89점\n* 하: 60 ~ 69점\n* 비고: 작품전시회 참여 필수, 60점 미만 시 재평가.  \n(2) 기사자격증\n* 상: 전공 1급 (정보처리기사, 전자기사, 반도체설계기사, 리눅스마스터 1급 등)\n* 중: 전공 2급 (LPIC, CCNA/CCNP/CCIE, SCJP/OCJP, OCA/OCP 등)\n* 하: 협회 자격증, MOS 2개, 컴활2급+워드 등\n* 비고: 전공 관련 취업자는 1급(상)으로 인정.  \n(3) 영어성적\n* 상: TOEIC 750점 이상 / 스피킹 Lv.8\n* 중: TOEIC 651 ~ 749점 / 스피킹 Lv.6~7\n* 하: TOEIC 600 ~ 650점 또는 교내 토익 1·2 수강 / 스피킹 Lv.4~5\n* 비고: 취업자는 성적 미제출 시 650점 간주.  \n(4) 전공이수 학점\n* 상: 전공 75학점 + 대학수학1·2 + 공학종합설계1·2\n* 중: 전공 72학점 + 대학수학1·2 + 공학종합설계1·2\n* 하: 전공 48~71학점 + 대학수학1·2 + 공학종합설계1·2\n* 비고: 인턴십/현장실습 참여 시 해당 학기 공학종합설계 이수 인정.  \n3. 기타 필수 요건\n* 실무능력: 학과 졸업전시회 작품 제출 필수\n* 졸업인증제: CREOS 인증 필수\n* 캠프: SKON 캠프(2012학번 이후), DREAM 캠프(2010학번 이후) 수료\n* 참고사항: 2027년까지 전공 과목 개설이 유지되나 조기 폐강될 수 있으므로 빠른 이수 권장.'), Document(metadata={'h1': '컴퓨터공학과/2022학번/졸업요건'}, page_content='# 컴퓨터공학과/2022학번/졸업요건\n2022학번 컴퓨터공학과 졸업요건입니다.\n1. 전공핵심 교과목 (필수 이수)\n2021학번 이후 입학생(2022학번 포함)은 아래 전공핵심 과목을 모두 이수해야 하며, 미이수 시 졸업이 불가합니다. (취업, 현장학습 등 예외 없음)\n* C프로그래밍 (CE1001)\n* 컴퓨터구조 (CE1063)\n* 자료구조 (CE1008)\n* 운영체제 (CE1069)\n* 졸업논문및시험 (CE1999): 졸업 직전 학기에 반드시 수강 신청해야 함.  \n2. 졸업요건 통과 기준 (4개 요소)\n졸업요건 4개 요소(졸업작품, 기사자격증, 영어성적, 전공이수) 중 ‘상 2개 + 중 2개’ 이상 또는 그에 상응하는 등급을 충족해야 합니다.\n* 졸업논문및시험(CE1999) P(Pass) 필수  \n(1) 졸업작품\n* 상: 90점 이상 (또는 1급 기사자격증 취득 시 인정)\n* 중: 70 ~ 89점\n* 하: 60 ~ 69점\n* 비고: 작품전시회 참여 필수, 60점 미만 시 재평가.  \n(2) 기사자격증\n* 상: 전공 1급 (정보처리기사, 전자기사, 반도체설계기사, 리눅스마스터 1급 등)\n* 중: 전공 2급 (LPIC, CCNA/CCNP/CCIE, SCJP/OCJP, OCA/OCP 등)\n* 하: 협회 자격증, MOS 2개, 컴활2급+워드 등\n* 비고: 전공 관련 취업자는 1급(상)으로 인정.  \n(3) 영어성적\n* 상: TOEIC 750점 이상 / 스피킹 Lv.8\n* 중: TOEIC 651 ~ 749점 / 스피킹 Lv.6~7\n* 하: TOEIC 600 ~ 650점 또는 교내 토익 1·2 수강 / 스피킹 Lv.4~5\n* 비고: 취업자는 성적 미제출 시 650점 간주.  \n(4) 전공이수 학점\n* 상: 전공 75학점 + 대학수학1·2 + 공학종합설계1·2\n* 중: 전공 72학점 + 대학수학1·2 + 공학종합설계1·2\n* 하: 전공 48~71학점 + 대학수학1·2 + 공학종합설계1·2\n* 비고: 인턴십/현장실습 참여 시 해당 학기 공학종합설계 이수 인정.  \n3. 기타 필수 요건\n* 실무능력: 학과 졸업전시회 작품 제출 필수\n* 졸업인증제: CREOS 인증 필수\n* 캠프: SKON 캠프(2012학번 이후), DREAM 캠프(2010학번 이후) 수료\n* 참고사항: 2027년까지 전공 과목 개설이 유지되나 조기 폐강될 수 있으므로 빠른 이수 권장.')]
---------------------------------------
[Document(id='eea0e61b-2362-492c-b44c-d14f076aa82c', metadata={'h1': '컴퓨터공학과/2022학번/졸업요건'}, page_content='# 컴퓨터공학과/2022학번/졸업요건  \n1. 전공핵심 교과목 (필수 이수)\n2021학번 이후 입학생(2022학번 포함)은 아래 전공핵심 과목을 모두 이수해야 하며, 미이수 시 졸업이 불가합니다. (취업, 현장학습 등 예외 없음)\n* C프로그래밍 (CE1001)\n* 컴퓨터구조 (CE1063)\n* 자료구조 (CE1008)\n* 운영체제 (CE1069)\n* 졸업논문및시험 (CE1999): 졸업 직전 학기에 반드시 수강 신청해야 함.  \n2. 졸업요건 통과 기준 (4개 요소)\n졸업요건 4개 요소(졸업작품, 기사자격증, 영어성적, 전공이수) 중 ‘상 2개 + 중 2개’ 이상 또는 그에 상응하는 등급을 충족해야 합니다.\n* 졸업논문및시험(CE1999) P(Pass) 필수  \n(1) 졸업작품\n* 상: 90점 이상 (또는 1급 기사자격증 취득 시 인정)\n* 중: 70 ~ 89점\n* 하: 60 ~ 69점\n* 비고: 작품전시회 참여 필수, 60점 미만 시 재평가.  \n(2) 기사자격증\n* 상: 전공 1급 (정보처리기사, 전자기사, 반도체설계기사, 리눅스마스터 1급 등)\n* 중: 전공 2급 (LPIC, CCNA/CCNP/CCIE, SCJP/OCJP, OCA/OCP 등)\n* 하: 협회 자격증, MOS 2개, 컴활2급+워드 등\n* 비고: 전공 관련 취업자는 1급(상)으로 인정.  \n(3) 영어성적\n* 상: TOEIC 750점 이상 / 스피킹 Lv.8\n* 중: TOEIC 651 ~ 749점 / 스피킹 Lv.6~7\n* 하: TOEIC 600 ~ 650점 또는 교내 토익 1·2 수강 / 스피킹 Lv.4~5\n* 비고: 취업자는 성적 미제출 시 650점 간주.  \n(4) 전공이수 학점\n* 상: 전공 75학점 + 대학수학1·2 + 공학종합설계1·2\n* 중: 전공 72학점 + 대학수학1·2 + 공학종합설계1·2\n* 하: 전공 48~71학점 + 대학수학1·2 + 공학종합설계1·2\n* 비고: 인턴십/현장실습 참여 시 해당 학기 공학종합설계 이수 인정.  \n3. 기타 필수 요건\n* 실무능력: 학과 졸업전시회 작품 제출 필수\n* 졸업인증제: CREOS 인증 필수\n* 캠프: SKON 캠프(2012학번 이후), DREAM 캠프(2010학번 이후) 수료\n* 참고사항: 2027년까지 전공 과목 개설이 유지되나 조기 폐강될 수 있으므로 빠른 이수 권장.')]
[Document(metadata={'h1': '전자컴퓨터공학과/2021학번~2022학번/졸업요건'}, page_content='# 전자컴퓨터공학과/2021학번~2022학번/졸업요건\n2021학번부터 2022학번까지 전자컴퓨터공학과 졸업요건입니다.\n1. 적용 규정 (통합 이전 학과 요건)\n* 기본 원칙: 2022학번까지의 전자컴퓨터공학과 소속 학생은 통합 이전 학과(전자공학과 또는 컴퓨터공학과)의 졸업요건을 적용받습니다.\n* 본인이 따르고 있는 교육과정(전자공학 또는 컴퓨터공학)의 요건을 확인해야 합니다.  \n2. 전공핵심 교과목 (21학번 이후 규정 적용)\n통합 이전 교육과정을 따르더라도, 21학번 이후 학생이므로 아래 [전자컴퓨터공학과 전공핵심]으로 지정된 과목을 반드시 이수해야 합니다.\n* 전자컴퓨터공학개론(EN1001) 또는 인공지능기초(EN1065) 중 택 1\n* C프로그래밍 (EN1002)\n* 컴퓨터구조 (EN1011)\n* 논리회로 (EN1006)\n* 졸업논문및시험 (EN1066)  \n3. 졸업작품 및 논문\n* 필수: 졸업작품 제출 및 심사 통과 (작품전 참가 필수)\n* 필수: 졸업논문 제출 (취업 여부 무관)\n* 필수: 졸업 직전 학기 "졸업논문및시험(EN1066)" 수강  \n4. 기타 사항\n* 졸업인증제: CREOS 인증 필수\n* 참고사항: 통합 이전 학과의 과목 개설은 2027년까지 유지될 예정이나, 조기 폐강 가능성이 있으므로 빠른 이수가 필요합니다.'), Document(metadata={'h1': '전자컴퓨터공학과/2023학번/졸업요건'}, page_content='# 전자컴퓨터공학과/2023학번/졸업요건\n2023학번 전자컴퓨터공학과 졸업요건입니다.\n1. 전공핵심 및 필수 교과목 (필수 이수)\n2023학번 이후 입학생은 아래 과목과 학년별 개설 과목을 필수로 이수해야 합니다.\n* 전공핵심 4과목 전체:\n1. 전자컴퓨터공학개론(EN1001) 또는 인공지능기초(EN1065) 중 택 1\n2. C프로그래밍 (EN1002)\n3. 컴퓨터구조 (EN1011)\n4. 논리회로 (EN1006)\n* 저학년 필수 과목: 1학년 1·2학기, 2학년 1학기에 개설되는 전체 전공교과목 이수\n* 설계 과목: 공학종합설계1, 공학종합설계2 학점 취득\n* 졸업논문및시험 (EN1066): 졸업 직전 학기 필수 수강 (미이수 시 졸업 불가)  \n2. 영어 요건 (택 1)\n아래 어학 성적 중 하나 이상을 충족해야 합니다.\n* TOEIC: 700점 이상\n* TOEIC Speaking: Lv.5 이상\n* OPIC: IL 이상  \n3. 졸업작품 및 논문 (전체 공통)\n취업 여부와 무관하게 모든 졸업예정자는 아래 사항을 이행해야 합니다.\n* 졸업작품: 제출 및 심사 통과 (작품전 참가 필수)\n* 졸업논문: 파일 제출  \n4. 기타 요건\n* 학교 공통 졸업요건 및 졸업인증제(CREOS) 인증 필수')]
---------------------------------------
```
#### 결과
- bm25는 split기반이라 단어 추출같은 부분에서 강하여 k값이 원하는대로 나오는 것을 확인할 수 있으나 줄임말 같은 부분에서 약함
- 의미기반 리트리버는 상단에 정확한 내용이 있더라도 본문에 의미 정도에 달라서 정확한 값을 가져올 수 없음
- 이후 고려사항
- - 앙상블 리트리버를 사용하여 두 리트리버를 결합하여 사용
- - 사용자 쿼리를 보정해줘서 정확한 k값을 도달하기 위한 노드 생성
| 현 상황에선 의미기반 리트리버의 정확성이 떨어지므로 사용자 쿼리를 보정하는 방향이 좋아보임